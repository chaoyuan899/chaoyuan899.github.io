
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="zh-CN"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>CAEmitterLayer实现粒子效果 - 朝元的博客</title>
  <meta name="author" content="朝元">
  <!--[if lt IE 9]>
    <script src="http://x.papaapp.com/farm1/a571d2/8dda131d/html5shiv.js"></script>
    <![endif]-->
  
  <meta name="description" content="CAEmitterLayer实现粒子效果 在iOS 5中，苹果引入了一个新的CALayer子类叫做CAEmitterLayer。CAEmitterLayer是一个高性能的粒子引擎，被用来创建实时例子动画如：烟雾，火，雨等等这些效果。 &hellip;">
  

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chaoyuan899.github.io/blog/2014/12/28/caemitterlayershi-xian-li-zi-xiao-guo/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script type="text/javascript" src="http://t.papaapp.com/js/libs/jquery/1.7.2/jquery.js"></script>
  <link href="/atom.xml" rel="alternate" title="朝元的博客" type="application/atom+xml">

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-58019483-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>
<body   >
  <header id="header" class="clearfix">    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                <a id="logo" href="/">
                   朝元的博客
                </a>
                <p class="description">天道不一定酬勤，深度思考比勤奋更重要。</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="index-nav current" href="/">Blog</a>
<a class="archives-nav" href="/blog/archives">Archives</a>
                </nav>
            </div>
        </div>
    </div>
</header>
  <div id="body">
    <div class="container">
    	<div class="col-group">
			<div class="col-8" id="main">
  <div class="res-cons">
  <article class="post clearfix">
  
  <header>
    
      <h1 class="post-title">CAEmitterLayer实现粒子效果</h1>
    
    
      <p class="post-meta">
        








  


<time datetime="2014-12-28T14:13:54+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="post-content"><p>在iOS 5中，苹果引入了一个新的CALayer子类叫做CAEmitterLayer。CAEmitterLayer是一个高性能的粒子引擎，被用来创建实时例子动画如：烟雾，火，雨等等这些效果。</p>

<p>CAEmitterLayer看上去像是许多CAEmitterCell的容器，这些CAEmitierCell定义了一个例子效果。你将会为不同的例子效果定义一个或多个CAEmitterCell作为模版，同时CAEmitterLayer负责基于这些模版实例化一个粒子流。一个CAEmitterCell类似于一个CALayer：它有一个contents属性可以定义为一个CGImage，另外还有一些可设置属性控制着表现和行为。我们不会对这些属性逐一进行详细的描述，你们可以在CAEmitterCell类的头文件中找到。</p>

<p>我们来举个例子。我们将利用在一圆中发射不同速度和透明度的粒子创建一个火爆炸的效果。清单6.13包含了生成爆炸的代码。图6.13是运行结果</p>

<p>清单6.13 用CAEmitterLayer创建爆炸效果</p>

<p>`#import &ldquo;ViewController.h&rdquo;</p>

<p>`#import &lt;QuartzCore/QuartzCore.h></p>

<p>@interface ViewController ()</p>

<p>@property (nonatomic, weak) IBOutlet UIView *containerView;</p>

<p>@end</p>

<p>@implementation ViewController</p>

<ul>
<li><p>(void)viewDidLoad
{
 [super viewDidLoad];
 ￼
 //create particle emitter layer
 CAEmitterLayer *emitter = [CAEmitterLayer layer];
 emitter.frame = self.containerView.bounds;
 [self.containerView.layer addSublayer:emitter];</p>

<p> //configure emitter
 emitter.renderMode = kCAEmitterLayerAdditive;
 emitter.emitterPosition = CGPointMake(emitter.frame.size.width / 2.0, emitter.frame.size.height / 2.0);</p>

<p> //create a particle template
 CAEmitterCell *cell = [[CAEmitterCell alloc] init];
 cell.contents = (__bridge id)[UIImage imageNamed:@&ldquo;Spark.png&rdquo;].CGImage;
 cell.birthRate = 150;
 cell.lifetime = 5.0;
 cell.color = [UIColor colorWithRed:1 green:0.5 blue:0.1 alpha:1.0].CGColor;
 cell.alphaSpeed = -0.4;
 cell.velocity = 50;
 cell.velocityRange = 50;
 cell.emissionRange = M_PI * 2.0;</p>

<p> //add particle template to emitter
 emitter.emitterCells = @[cell];
}
@end`</p></li>
</ul>


<p>CAEMitterCell的属性基本上可以分为三种：</p>

<p>这种粒子的某一属性的初始值。比如，color属性指定了一个可以混合图片内容颜色的混合色。在示例中，我们将它设置为桔色。
例子某一属性的变化范围。比如emissionRange属性的值是2π，这意味着例子可以从360度任意位置反射出来。如果指定一个小一些的值，就可以创造出一个圆锥形
指定值在时间线上的变化。比如，在示例中，我们将alphaSpeed设置为-0.4，就是说例子的透明度每过一秒就是减少0.4，这样就有发射出去之后逐渐小时的效果。
CAEmitterLayer的属性它自己控制着整个例子系统的位置和形状。一些属性比如birthRate，lifetime和celocity，这些属性在CAEmitterCell中也有。这些属性会以相乘的方式作用在一起，这样你就可以用一个值来加速或者扩大整个例子系统。其他值得提到的属性有以下这些：</p>

<p>preservesDepth，是否将3D例子系统平面化到一个图层（默认值）或者可以在3D空间中混合其他的图层
renderMode，控制着在视觉上粒子图片是如何混合的。你可能已经注意到了示例中我们把它设置为kCAEmitterLayerAdditive，它实现了这样一个效果：合并例子重叠部分的亮度使得看上去更亮。如果我们把它设置为默认的kCAEmitterLayerUnordered，效果就没那么好看了.</p>
</div>


  <footer class="post-footer">
    <div class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">朝元</span></span>
 and 
      File under 


    </div>
    
      <div class="sharing">
  
  
  
</div>

    
    <div class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/12/27/miss-you/" title="Previous Post: 天道不一定酬勤，深度思考比勤奋更重要">&laquo; 天道不一定酬勤，深度思考比勤奋更重要</a>
      
      
    </div>
  </footer>
</article>

  </div>
</div>

  <aside id="secondary">
  
    <section class="widget">
    <form id="search" action="https://www.google.com/search" method="get">
    	<input type="hidden" name="q" value="site:chaoyuan899.github.io"/>
    	<input type="text" name="q" results="0" class="text" placeholder="Google搜索"/>
    </form>
</section>

<section class="widget">
	<h3 class="widget-title">最新文章</h3>
	<ul class="widget-list">
		
     	<li>
      	  <a href="/blog/2014/12/28/caemitterlayershi-xian-li-zi-xiao-guo/">CAEmitterLayer实现粒子效果</a>
      	</li>
    	
     	<li>
      	  <a href="/blog/2014/12/27/miss-you/">天道不一定酬勤，深度思考比勤奋更重要</a>
      	</li>
    	
	</ul>
</section>




  
</aside>


      	</div>
    </div>
  </div>
  <footer id="footer">
  	<div class="container">
	Copyright &copy; 2014 - 朝元 -
  <span class="credit">Powered by <a rel="nofollow" href="http://octopress.org">Octopress</a> on <a rel="nofollow" href="http://pages.github.com/">GitHubPages</a>
  </span>
  - <span class="credit">Theme by <a rel="nofollow" href="http://pagecho.com">Cho</a></span>


</div>

  </footer>
  











</body>
</html>
